<script src="https://code.jquery.com/jquery-2.1.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="{{'/public/tabs.js' | prepend: site.baseurl | prepend: site.url}}"></script>

<script src="{{'/public/site.js' | prepend: site.baseurl | prepend: site.url}}"></script>

<script src="{{'/public/skipto.min.js' | prepend: site.baseurl | prepend: site.url}}" type="text/javascript"></script>

<script type="text/javascript">
    var SkipToConfig = {
        settings: {
            skipTo: {
                headings: "h1, h2, h3, h4",
                main: "main, [role=main]",
                landmarks: "[role=navigation], [role=search]",
                sections: "nav",
                accesskey: "0",
                wrap: "true",
                visibility: "onfocus",
                attachElement: ".skip-nav-elements"
            }
        }
    };
</script>
<script src="{{'/public/skipto.min.js' | prepend: site.baseurl | prepend: site.url}}" type="text/javascript"></script>
<script type="text/javascript"
        src="{{'/public/jquery.swiftype.search.js' | prepend: site.baseurl | prepend: site.url}}"></script>
<script type="text/javascript"
        src="{{'/public/jquery.swiftype.autocomplete.js' | prepend: site.baseurl | prepend: site.url}}"></script>
<script>
    $(document).ready(function () {

        skipToMenuInit({
            settings: {
                skipTo: {
                    headings: "h1, h2, h3, h4",
                    main: "main, [role=main]",
                    landmarks: "[role=navigation], [role=search]",
                    sections: "nav",
                    accesskey: "0",
                    wrap: "true",
                    visibility: "onfocus",
                    attachElement: ".skip-nav-elements"
                }
            }
        });
        var segementedAutocompleteDropDown = function (ctx, data) {
            var results = [];

            $.each(data, function (docType, opts) {
                $.each(opts, function (idx, result) {
                    // Specify a valid Swiftype field/meta tag. results.FIELD == VALUE
                    results.push(result);
                });
            });
            var segment_two_list = $(
                '<div class="autocomplete__segment">' +
                '<ul id="search-results" class="autocomplete__segment-header"  role="listbox"\n' +
                '      aria-label="Search Results"></ul>' +
                '</div>');

            // Create a reusable function to render results.
            function renderResult(result) {
                var title = result.title,
                    section = result.sections[0],
                    url = result['url'];

                if (result.title == null || title === undefined) {
                    title = result.highlight.sections;
                    section = result.sections[1] || '';
                }

                return $(
                    '<li role="option" id="' + result['id'] + '" class="autocomplete-result"  aria-label="' + title + '"><a href="' + url + '">' +
                    '<span\n        class="autocomplete-result__title">' + title + '</span> <br>' +
                    '<small class="autocomplete-result__description muted" aria-label="' + section + '">' + section + '</small>' +
                    '</a>\n</li>'
                );
            }

            $.each(results, function (idx, item) {
                ctx.registerResult(renderResult(item).appendTo(segment_two_list), item);
            });

            if (results.length > 0) {
                segment_two_list.appendTo(ctx.list);
            }

            $('#search').attr('aria-expanded', true);
            $('#search').attr('aria-activedescendant', '#search-result');
            $('#search-results >li').on('focusin', function () {
                $(this).attr('aria-selected', true)
            });

            $('#search-results >li').on('focusoff', function () {
                $(this).attr('aria-selected', false);
            });

            $('#search-results > li> a').on('click', function () {
                $('#search').attr('aria-expanded', false);
            });
            console.log(results, data);
        };

        $('#search').swiftype({
            resultRenderFunction: segementedAutocompleteDropDown,
            suggestionListType: 'div',
            resultLimit: 10,
            resultListSelector: '.autocomplete-result',
            resultContainingElement: '#st-results-container', // Points to our results content division element.
            engineKey: 'Xk5RQZP53Ry3gEkcFvYK',// Our Site Search Engine's unique key. Use your own!
            fetchFields: ['url', 'title', 'type', 'body']
        });

        $('#search').swiftypeSearch({
            engineKey: 'Xk5RQZP53Ry3gEkcFvYK',// Our Site Search Engine's unique key. Use your own!
            resultLimit: 10,
        });
    });
</script>